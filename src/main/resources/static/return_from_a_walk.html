<!DOCTYPE html>

<html>

<head>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
  <script>

    function setPage(){
      if (localStorage.getItem('auth') == "guest") {
        let menu_items = document.getElementsByClassName("nav-link");
        menu_items[1].classList.add("disabled");
        menu_items[2].classList.add("disabled");
        menu_items[3].classList.add("disabled");

      } else if (localStorage.getItem('auth') == "admin") {
        let menu_items = document.getElementsByClassName("nav-link");
        menu_items[2].setAttribute("href","./user_history.html");


      } else {
        let menu_items = document.getElementsByClassName("nav-link");
        menu_items[1].classList.add("disabled");
        menu_items[3].classList.add("disabled");
      }
    }

    function submit(){
      let animal_id =new URLSearchParams(window.location.search).get("animal_id");
        async function doRequest(){
          let url = 'http://localhost:8080/return';
          let data = {
            'animal_id': animal_id.toString(),
            'comment' : document.getElementById("Textarea").value,
          };

          let res = await fetch(url, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
          });

          if (res.ok) {

            //window.location.replace("./index.html");
            let ret = await res;

            return ret;

          } else {

            //window.location.replace("./index.html");
            return `HTTP error: ${res.status}`;
          }
      }

      doRequest();
    }
  </script>
</head>
<header>

  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="#">Animal Shelter</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item active">
          <a class="nav-link" href="./index.html">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="./walk.html">Animals on walk</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="./history.html">History</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="./add_animal.html">Add Animal</a>
        </li>
      </ul>
    </div>
  </nav>
</header>

<body onload="setPage()">
<form>
  <div class="form-group">

    <div class="form-group">
      <label for="Textarea">Comment</label>
      <textarea class="form-control" id="Textarea" rows="3"></textarea>
    </div>
  </div>

  <a class="btn btn-primary" onclick="submit()">Return from a walk</a>
</form>
</body></html>